---
marp: true
---

# 4. 성능 테스트 패턴 및 안티패턴

## 최 혁

---

# 성능 테스트 유형

> 어떤 테스트를 하더라도 그 도메인을 심사숙고해야 한다.

### 가장 일반적인 성능 테스트와 종류별 질문 예시

- 지연 테스트: 종단 트랜잭션에 걸리는 시간은?
- 처리율 테스트: 현재 시스템이 처리 가능한 동시 트랜잭션 개수는?
- 부하 테스트: 특정 부하를 시스템이 감당할 수 있는가?
- 스트레스 테스트: 이 시스템의 한계점은 어디까지인가?
- 내구성 테스트: 시스템을 장시간 실행할 경우 성능 이상 증상이 나타나는가?
- 용량 계획 테스트: 리소스를 추가한 만큼 시스템이 확장되는가?
- 저하 테스트: 시스템이 부분적으로 실패할 경우 어떤 일이 벌어지는가?

---

### 지연(Latency) 테스트

- 가장 일반적인 성능 테스트
- `고객이 트랜잭션을 얼마나 오래 참고 기다려야 하는지` 특정한 시스템 수치
- 단순 평균값은 애플리케이션의 요청 응답성을 측정하는 지표로 소용이 없는 것을 주의해야 한다.

### 처리율(throughput) 테스트

- 처리율과 지연은 밀접하게 연관되어 있기에 같이 모니터링하며 테스트해야 한다.
- 지연 분포가 갑자기 변하는 시점(한계점 or 변곡점)이 최대 처리율이다.

### 부하(load) 테스트

- `시스템이 이 정도 부하를 견딜 수 있는지 여부`를 구하는 과정이다.

---

### 스트레스 테스트

- `시스템 여력이 어느정도인지 알아보는 수단`이다.
- 일정한 트랜잭션(특정 처리율)을 시스템에 계속 걸 때 측정값이 나빠지기 시작하기 직전의 값이 최대 처리율이다.

### 내구 테스트

- 메모리 누수, 캐시 오염, 메모리 단편화(fragmentation) 등 시간이 지나고 나서야 드라나는 문제점 감지가 목적이다.
- 평균 사용률로 시스템에 일정 부하를 계속 주며 모니터링하다가 갑자기 리소스가 고갈되거나 시스템이 깨지는 지점을 찾는다.
- 보통 빠른 응답을 요구하는 시스템에서 많이 한다.

---

### 용량 계획(capacity planning) 테스트

- `업그레이드한 시스템이 어느 정도 부하를 감당할 수 있는지 미리 내다보는 것`이다.
- 어떤 이벤트나 위협 요소에 대응하는 것이 아니라, 예정된 계획의 일부분으로 실행하는 경우가 많다.

### 저하(degradation) 테스트

- 복원 테스트로 생각하면 된다.
- 평상시 운영 환경과 동등한 수준의 부하를 시스템에 가하는 도중, 어떤 컴포넌트나 전체 서브시스템이 갑자기 능력을 상실하는 시점에 벌어지는 일을 확인한다.

---

# 기본 베스트 프랙티스

> 성능 튜닝시 주안점을 두어야 할 세 가지 원칙

1. 나의 관심사가 무엇인지 식별하고 그 측정 방법을 고민한다.
2. 최적화하기 용이한 부분이 아니라, 중요한 부분을 최적화한다.
3. 중요한 관심사를 먼저 다룬다.

---

- **하향식 성능**: 전체 애플리케이션의 성능 양상부터 먼저 알아보는 접근방식
- **테스트 환경 구축**: 가급적 모근 면에서 운영환경과 똑같이 복제하여 테스트해야 쓸모있는 결과를 얻을 수 있다.
- **성능 비기능 요건**: 최적화하려는 핵심 지표
  - `95% 백분위 트랜잭션 시간을 100ms로 줄인다.`같이 명확한 목표를 세우는 것이 좋다.
- **자바에서 특정한 이슈**: JIT 컴파일을 유심히 봐야 한다.
- **SDLC 일부로 성능 테스트 수행하기**

  - SDLC(Software Development LifeCycle)의 일부로서 성능 회귀 테스트를 상시 수행하는게 좋다.

  ***

  # 성능 안티패턴

  - 지루함: 개발자의 지루함이 프로젝트를 오버스택으로 부풀리는 악영향으로 초래될 수 있다.
  - 이력서 부풀리기: 프로젝트를 불필요한 방향으로 끌고 가는 선택의 발단이 될 수 있다.
  - 또래 압박: 신입개발자가 두려워하거나 경쟁심에 섣불리 판단하는 것들에 해당한다.
  - 이해 부족: 기술 스택에 대한 이해가 부족한 상태로 프로젝트에 적용하면 모두가 힘들다
  - 오해와 있지도 않은 문제: 문제 자체가 무엇인지 정확히 이해해야 한다(성능 지표를 수집/분석해야만 비로소 문제의 본질을 파악할 수 있다)
